<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music Player + Lamp Dark Mode</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin="anonymous" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root {
  --primary-color: #ec1f55;
  --text-color: #333;
  --bg-color: #f5f5f5;
  --card-color: #fff;
  --shadow: rgba(0,0,0,0.1);
}

body.dark {
  --primary-color: #ff7b8b;
  --text-color: #eee;
  --bg-color: #121212;
  --card-color: #1f1f1f;
  --shadow: rgba(255,255,255,0.05);
}

* {padding: 0; margin: 0; box-sizing: border-box;}
body {
  font-family: "Poppins", sans-serif;
  background-color: var(--bg-color);
  color: var(--text-color);
  transition: background 0.4s, color 0.4s;
}
.player {
  position: relative;
  max-width: 480px;
  margin: 0 auto;
}
.dashboard {
  padding: 16px 16px 20px;
  background-color: var(--card-color);
  position: fixed;
  top: 0;
  width: 100%;
  max-width: 480px;
  border-bottom: 1px solid #ebebeb;
  box-shadow: 0 2px 3px var(--shadow);
  transition: background 0.3s, color 0.3s;
  z-index: 5;
}
header {
  text-align: center;
  margin-bottom: 10px;
}
header h4 {
  color: var(--primary-color);
  font-size: 12px;
}
header h2 {
  color: var(--text-color);
  font-size: 20px;
  margin-bottom: 4px;
}

/* CD */
.cd {
  display: flex;
  margin: auto;
  width: 200px;
  position: relative;
  z-index: 3;
}
.cd-thumb {
  width: 100%;
  padding-top: 100%;
  border-radius: 50%;
  background-size: cover;
  background-position: center;
  box-shadow: 0 0 12px rgba(0,0,0,0.2);
  position: relative;
  z-index: 3;
}

/* CONTROL */
.control {
  display: flex;
  align-items: center;
  justify-content: space-around;
  padding: 18px 0 8px 0;
}
.control .btn {
  color: #888;
  padding: 18px;
  font-size: 18px;
  cursor: pointer;
  transition: color 0.3s;
}
.control .btn.active, .control .btn:hover {
  color: var(--primary-color);
}
.control .btn-toggle-play {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  font-size: 24px;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--primary-color);
  box-shadow: 0 0 8px var(--shadow);
}
.player.playing .icon-pause {display: inline-block;}
.player.playing .icon-play {display: none;}
.icon-pause {display: none;}

/* Progress */
.progress {
  width: 100%;
  -webkit-appearance: none;
  height: 6px;
  background: #d3d3d3;
  border-radius: 3px;
  outline: none;
  opacity: 0.8;
  margin-top: 10px;
  transition: background 0.3s;
  position: relative;
  z-index: 3;
}
body.dark .progress { background: #333; }
.progress::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 12px;
  height: 6px;
  background-color: var(--primary-color);
  cursor: pointer;
}

/* Playlist */
.playlist {
  margin-top: 420px;
  padding: 12px;
}
.song {
  display: flex;
  align-items: center;
  margin-bottom: 12px;
  background-color: var(--card-color);
  padding: 8px 16px;
  border-radius: 5px;
  box-shadow: 0 2px 3px var(--shadow);
  transition: background 0.3s, color 0.3s;
}
.song.active {
  background-color: var(--primary-color);
  color: #fff;
}
.song .thumb {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background-size: cover;
  margin: 0 8px;
}
.song .body {flex: 1; padding: 0 16px;}
.song .title {font-size: 18px;}
.song .author {font-size: 12px; opacity: 0.7;}
.song .option {padding: 16px 8px; font-size: 18px;}

/* === LAMP === */
.light-control {
  position: fixed;
  top: 10px;
  right: 10px;
  width: 100px;
  height: 160px;
  z-index: 1000;
  cursor: grab;
  user-select: none;
}
.bulb-svg {
  width: 100%;
  height: 100%;
}
#cord {
  stroke: #666;
  stroke-width: 3;
  stroke-linecap: round;
}
#bulb {
  fill: #f9f9b0;
  stroke: #444;
  stroke-width: 2;
  filter: drop-shadow(0 0 3px #fff);
  transition: fill 0.3s ease, filter 0.3s ease;
}
#bulb.glow {
  fill: #fff9a6;
  filter: drop-shadow(0 0 15px #ffff80);
}
.hit-area {
  fill: transparent;
  cursor: grab;
}
.hit-area:hover {
  fill: rgba(255, 255, 255, 0.05);
}
</style>
</head>

<body>
<!-- Lamp control -->
<div class="light-control">
  <svg viewBox="0 0 100 160" class="bulb-svg">
    <rect class="hit-area" x="10" y="0" width="80" height="130"></rect>
    <line id="cord" x1="50" y1="0" x2="50" y2="80"></line>
    <circle id="bulb" cx="50" cy="100" r="20"></circle>
  </svg>
</div>

<!-- Music Player -->
<div class="player">
  <div class="dashboard">
    <header>
      <h4>Now playing:</h4>
      <h2>String 57th & 9th</h2>
    </header>

    <div class="cd">
      <div class="cd-thumb"
        style="background-image: url('https://i.ytimg.com/vi/jTLhQf5KJSc/maxresdefault.jpg')">
      </div>
    </div>

    <div class="control">
      <div class="btn btn-repeat"><i class="fas fa-redo"></i></div>
      <div class="btn btn-prev"><i class="fas fa-step-backward"></i></div>
      <div class="btn btn-toggle-play">
        <i class="fas fa-pause icon-pause"></i>
        <i class="fas fa-play icon-play"></i>
      </div>
      <div class="btn btn-next"><i class="fas fa-step-forward"></i></div>
      <div class="btn btn-random"><i class="fas fa-random"></i></div>
    </div>

    <input id="progress" class="progress" type="range" value="0" step="1" min="0" max="1000">
    <audio id="audio" src=""></audio>
  </div>
  <div class="playlist"></div>
</div>

<script>
const $ = document.querySelector.bind(document)
const $$ = document.querySelectorAll.bind(document)
const PLAYER_STORAGE_KEY = 'MUSIC_PLAYER'
const player = $('.player')
const cd = $('.cd')
const heading = $('header h2')
const cdThumb = $('.cd-thumb')
const audio = $('#audio')
const playBtn = $('.btn-toggle-play')
const progress = $('#progress')
const nextBtn = $('.btn-next')
const prevBtn = $('.btn-prev')
const randomBtn = $('.btn-random')
const repeatBtn = $('.btn-repeat')
const playlist = $('.playlist')

const app = {
  currentIndex: 0,
  isPlaying: false,
  isRandom: false,
  isRepeat: false,
  config: JSON.parse(localStorage.getItem(PLAYER_STORAGE_KEY)) || {},
  songs: [
    {name:'End Of Beginning',singer:'Djo',path:'./asset/music/song1.mp3',image:'./asset/image/song1.jpg'},
    {name:'I Wanna Be Yours',singer:'Arctic Monkeys',path:'./asset/music/song2.mp3',image:'./asset/image/song2.jpg'},
    {name:'homesick',singer:'wave to earth',path:'./asset/music/song3.mp3',image:'./asset/image/song3.jpg'},
    {name:'See you again',singer:'tyler',path:'./asset/music/song4.mp3',image:'./asset/image/song4.jpg'},
    {name:'Still With You',singer:'Jung Kook',path:'./asset/music/song5.mp3',image:'./asset/image/song5.jpg'},
    {name:'vaicaunoicokhiennguoithaydoi',singer:'GREY D',path:'./asset/music/song6.mp3',image:'./asset/image/song6.jpg'},
    {name:'冬眠·2023',singer:'阿YueYue/刘兆宇',path:'./asset/music/song7.mp3',image:'./asset/image/song7.jpg'},
    {name:'pages',singer:'WIMY',path:'./asset/music/song8.mp3',image:'./asset/image/song8.jpg'},
  ],
  setConfig(key,value){this.config[key]=value;localStorage.setItem(PLAYER_STORAGE_KEY,JSON.stringify(this.config))},
  render(){
    const htmls=this.songs.map((song,index)=>`
      <div class="song ${index===this.currentIndex?'active':''}" data-index="${index}">
        <div class="thumb" style="background-image:url('${song.image}')"></div>
        <div class="body">
          <h3 class="title">${song.name}</h3>
          <p class="author">${song.singer}</p>
        </div>
        <div class="option"><i class="fas fa-ellipsis-h"></i></div>
      </div>`)
    playlist.innerHTML=htmls.join('')
  },
  defineProperties(){
    Object.defineProperty(this,'currentSong',{get(){return this.songs[this.currentIndex]}})
  },
  handleEvents(){
    const _this=this
    const cdWidth=cd.offsetWidth
    const cdThumbAnimate=cdThumb.animate([{transform:'rotate(360deg)'}],{duration:10000,iterations:Infinity})
    cdThumbAnimate.pause()

    document.onscroll=function(){
      const scrollTop=window.scrollY||document.documentElement.scrollTop
      const newcdWidth=cdWidth-scrollTop
      cd.style.width=newcdWidth>0?newcdWidth+'px':0
      cd.style.opacity=newcdWidth/cdWidth
    }

    playBtn.onclick=function(){_this.isPlaying?audio.pause():audio.play()}
    audio.onplay=function(){_this.isPlaying=true;player.classList.add('playing');cdThumbAnimate.play()}
    audio.onpause=function(){_this.isPlaying=false;player.classList.remove('playing');cdThumbAnimate.pause()}
    audio.ontimeupdate=function(){if(audio.duration){progress.value=Math.floor(audio.currentTime/audio.duration*1000)}}
    progress.onchange=function(e){audio.currentTime=audio.duration/1000*e.target.value}
    nextBtn.onclick=function(){_this.isRandom?_this.playRandomSong():_this.nextSong();audio.play();_this.render();_this.scrollToActiveSong()}
    prevBtn.onclick=function(){_this.isRandom?_this.playRandomSong():_this.prevSong();audio.play();_this.render();_this.scrollToActiveSong()}
    randomBtn.onclick=function(){_this.isRandom=!_this.isRandom;_this.setConfig('isRandom',_this.isRandom);this.classList.toggle('active',_this.isRandom)}
    repeatBtn.onclick=function(){_this.isRepeat=!_this.isRepeat;_this.setConfig('isRepeat',_this.isRepeat);this.classList.toggle('active',_this.isRepeat)}
    audio.onended=function(){_this.isRepeat?audio.play():nextBtn.click()}
    playlist.onclick=function(e){
      const songNode=e.target.closest('.song:not(.active)')
      if(songNode){_this.currentIndex=Number(songNode.dataset.index);_this.loadCurrentSong();_this.render();audio.play()}
    }
  },
  scrollToActiveSong(){
    setTimeout(()=>{$('.song.active').scrollIntoView({behavior:'smooth',block:'nearest'})},300)
  },
  loadCurrentSong(){
    heading.textContent=this.currentSong.name
    cdThumb.style.backgroundImage=`url('${this.currentSong.image}')`
    audio.src=this.currentSong.path
  },
  nextSong(){this.currentIndex++;if(this.currentIndex>=this.songs.length)this.currentIndex=0;this.loadCurrentSong()},
  prevSong(){this.currentIndex--;if(this.currentIndex<0)this.currentIndex=this.songs.length-1;this.loadCurrentSong()},
  playRandomSong(){let newIndex;do{newIndex=Math.floor(Math.random()*this.songs.length)}while(newIndex===this.currentIndex);this.currentIndex=newIndex;this.loadCurrentSong()},
  start(){this.defineProperties();this.handleEvents();this.loadCurrentSong();this.render();}
}
app.start()

// === LAMP ===
const cord=document.getElementById("cord");
const bulb=document.getElementById("bulb");
const hitArea=document.querySelector(".hit-area");
let isDragging=false,startY=0,currentLength=80,lightOn=false;

hitArea.addEventListener("mousedown",e=>{isDragging=true;startY=e.clientY;});
document.addEventListener("mousemove",e=>{
  if(!isDragging)return;
  const deltaY=e.clientY-startY;
  const newLength=Math.min(120,Math.max(80,currentLength+deltaY/2));
  cord.setAttribute("y2",newLength);
});
document.addEventListener("mouseup",()=>{
  if(!isDragging)return;
  isDragging=false;
  cord.setAttribute("y2",currentLength);
  lightOn=!lightOn;
  bulb.classList.toggle("glow",lightOn);
  document.body.classList.toggle("dark",lightOn);
});
</script>
</body>
</html>
